# 服务器管理

## 1. 检查连接是否正常

`PING`: 使用客户端redis服务器发送一个ping，如果客户端与服务器之间的连接正常，并且服务器的运作也正常的话，那么命令将返回一个PONG

## 2. 查看服务器信息

INFO [section]

查看redis服务器的各种信息和统计数值，通过给定可选的section参数，可以指定命令要返回的信息内容。

| 值           | 展示的信息                                                   |
| ------------ | ------------------------------------------------------------ |
| all          | 所有服务器信息                                               |
| default      | 默认，最常见也最重要的一些服务信息                           |
| server       | 服务器本身的信息，比如版本号、监听端口号、服务器id等         |
| clients      | 已连接客户端的信息，比如已连接客户端的数量，正在被阻塞的客户端数量等 |
| memoery      | 内存信息，比如内存占用数量，使用的内存分配器等等             |
| persistence  | 和rdb持久化以及aof持久化有关的信息，比如rdb持久化是否正在运行、aof文件重写是否正在进行等等 |
| stats        | 服务器的统计信息，比如已处理的命令请求数量、每秒钟处理的命令请求数量等等 |
| replication  | 和主从复制有关的信息，比如服务器的角色、主从服务器的连接状态是否正常等等 |
| cpu          | 服务器的系统cpu占用量和用户cpu占用量                         |
| commandstats | 命令执行的统计信息，比如命令执行的次数、命令耗费的cpu时间、执行每个命令耗费的平均cpu时间等 |
| cluster      | 集群功能的相关信息                                           |
| keyspace     | 和数据库键空间有关的信息，比如数据库的键数量、数据库已经被删除的过期键数量等等 |

## 3. 查看服务器正在执行的命令

MONITOR

实时的打印出redis服务器接收到的命令，格式为 时间戳 [数据库号码 ip地址和端口号] 被执行的命令

## 4. 发现执行慢的命令

### 4.1 记录慢查询日志

redis的慢查询功能用于将执行时间超过指定时长的命令记录下来，并向用户展示那些被记录的命令，方便用户发现运行缓慢的命令，并进行针对性优化

慢查询功能可以通过以下两个配置选项来进行设置：

slowlog-log-slower-than <microseconds>

执行时长超过microseconds微秒的命令将被记录，将这个值设置为负数表示关闭慢查询功能。默认值为10000，1秒=1百万微秒

slowlog-max-len <length>

慢查询日志的最大数量，当记录日志超过这个数量时，新日志会覆盖旧日志，默认值为128

### 4.2 查看慢日志

SLOWLOG GET [number]

返回服务器目前记录的慢查询日志，number为最多返回数量，不提供返回所有

### 4.3 其它命令

| s命令         | 作用                         |
| ------------- | ---------------------------- |
| slowlog len   | 查看目前已有的慢查询日志数量 |
| slowlog reset | 删除所有慢查询日志           |

## 5. 服务器密码

requirepass <password>

当客户端连接一个带密码的服务器时，必须执行AUTH <password> 命令来进行解锁，否则这个客户端就不能执行除auth以外的其它命令

## 6. 关闭服务器

shutdown [option]

在不给定option参数的情况下，服务器会先执行持久化操作：

- 如果打开了aof持久化，那么调用fdatasync，确保之前执行的命令能够被写入到硬盘
- 如果打开了rdb持久化并且数据库已经发生了改变，那么执行save命令

完成了上面操作后，服务器关闭。在打开了持久化功能的情况下，使用shutdown命令关闭服务器不会丢失任何数据。

option选项的值可以使save或者nosave：

- save 在关闭之前总是执行save命令，用于在没有开启rdb持久化的情况下，创建一个rdb文件来保存数据
- nosave 在关闭之前不执行save命令，用于在数据库可能已经出错的情况下，避免将错误数据保存到rdb文件里面

## 7. 现成的redis管理工具

- redislive
- redis commander
- redmon 

不够强大，不够稳定，目前还没有强大且稳定的工具被开源出来